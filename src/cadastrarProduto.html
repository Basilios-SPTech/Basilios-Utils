<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basilios - Cadastrar Produtos</title>
    <link rel="stylesheet" href="./css/cadastrarProduto.css">
</head>
<body>
    <div class="container">
        <header class="cabecalho">
            <h1 class="titulo-principal">Basilios</h1>
        </header>

        <div class="formulario">
            <h2 id="titulo-form" class="titulo-formulario">Cadastrar Produtos</h2>
            <form id="form-produto" class="espaco">
                <div class="gradegrade">
                    <input type="text" id="nome" placeholder="Nome do Produto" class="campoborda" required />
                    <input type="text" id="descricao" placeholder="Descrição" class="campoborda" required />
                </div>
                <div class="grade grade-1-2 gap-4">
                    <input type="number" id="preco" placeholder="Preço (R$)" step="0.01" class="campoborda" required />
                    <input type="url" id="imagem" placeholder="URL da Imagem" class="campoborda" />
                </div>

                <div class="grade">
                    <select id="categoria" class="campoborda" required>
                        <option value="">Selecione uma categoria</option>
                        <option>Lanches Premium</option>
                        <option>X-Burguer</option>
                        <option>Acompanhamentos</option>
                        <option>Burguers Vegetariano</option>
                        <option>X Picanha</option>
                        <option>X-Costela</option>
                        <option>X Salmão</option>
                        <option>X Calabresa</option>
                        <option>X Filé de Frango</option>
                        <option>X Mignon</option>
                        <option>Vegetarianos</option>
                        <option>X Burguer Picanha</option>
                        <option>Beirutes</option>
                        <option>Hot Dog</option>
                        <option>Lanches Tradicionais</option>
                        <option>Bebidas</option>
                        <option>Opções de Pães</option>
                    </select>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="btn-salvar">Salvar Produto</button>
                    <button type="button" id="btn-cancelar" class="btn-cancelar">Cancelar</button>
                </div>
            </form>
        </div>

        <div class="lista-produtos">
            <h2 class="titulo-lista">Produtos Cadastrados</h2>
            <div id="lista-produtos"></div>
            <div id="msg-sem-produtos" class="msg-sem-produtos">Nenhum produto cadastrado ainda.</div>
        </div>
    </div>

    <script>
        const CHAVE_STORAGE = 'produtos-basilios';

        const form = document.getElementById('form-produto');
        const tituloForm = document.getElementById('titulo-form');
        const inputNome = document.getElementById('nome');
        const inputDescricao = document.getElementById('descricao');
        const inputPreco = document.getElementById('preco');
        const inputImagem = document.getElementById('imagem');
        const inputCategoria = document.getElementById('categoria');
        const btnCancelar = document.getElementById('btn-cancelar');
        const listaProdutos = document.getElementById('lista-produtos');
        const msgSemProdutos = document.getElementById('msg-sem-produtos');

        let indiceEdicao = null;
        let produtos = JSON.parse(localStorage.getItem(CHAVE_STORAGE)) || [];

        function renderizarProdutos() {
            listaProdutos.innerHTML = '';
            if (produtos.length === 0) {
                msgSemProdutos.classList.remove('oculto');
            } else {
                msgSemProdutos.classList.add('oculto');

                const categorias = {};
                produtos.forEach((produto, i) => {
                    if (!categorias[produto.categoria]) {
                        categorias[produto.categoria] = [];
                    }
                    categorias[produto.categoria].push({ ...produto, index: i });
                });

                for (const categoria in categorias) {
                    const secao = document.createElement('div');
                    secao.className = 'secao-categoria';
                    secao.innerHTML = `<h3 class="titulo-categoria">${categoria}</h3>`;

                    const grid = document.createElement('div');
                    grid.className = 'grade-produtos';

                    categorias[categoria].forEach(produto => {
                        const card = document.createElement('div');
                        card.className = 'card-produto';
                        card.innerHTML = `
                            <img src="${produto.imagem || 'https://placehold.co/400x300/orange/'}" 
                                 alt="Produto: ${produto.nome}" 
                                 onerror="this.src='https://placehold.co/400x300/orange/white?text=Imagem+Indisponivel'">
                            <h3 class="texto-lg">${produto.nome}</h3>
                            <p class="texto-cinza">${produto.descricao}</p>
                            <p class="texto-vermelho">R$ ${produto.preco}</p>
                            <div class="flex gap-2 mt-4">
                                <button onclick="editarProduto(${produto.index})" class="btn-editar">Editar</button>
                                <button onclick="deletarProduto(${produto.index})" class="btn-deletar">Deletar</button>
                            </div>
                        `;
                        grid.appendChild(card);
                    });

                    secao.appendChild(grid);
                    listaProdutos.appendChild(secao);
                }
            }
        }

        function salvarProduto() {
            const nome = inputNome.value.trim();
            const descricao = inputDescricao.value.trim();
            const preco = parseFloat(inputPreco.value);
            const imagem = inputImagem.value.trim();
            const categoria = inputCategoria.value.trim();

            if (!nome || !descricao || isNaN(preco) || !categoria) {
                alert('Preencha todos os campos obrigatórios.');
                return;
            }

            const produto = { nome, descricao, preco, imagem, categoria };

            if (indiceEdicao !== null) {
                produtos[indiceEdicao] = produto;
                indiceEdicao = null;
            } else {
                produtos.push(produto);
            }

            salvarStorage();
            resetarFormulario();
            renderizarProdutos();
        }

        function editarProduto(i) {
            const produto = produtos[i];
            inputNome.value = produto.nome;
            inputDescricao.value = produto.descricao;
            inputPreco.value = produto.preco;
            inputImagem.value = produto.imagem;
            inputCategoria.value = produto.categoria;
            indiceEdicao = i;
            tituloForm.textContent = 'Editar Produto';
            btnCancelar.classList.remove('oculto');
        }

        function deletarProduto(i) {
            if (confirm('Tem certeza que deseja deletar este produto?')) {
                produtos.splice(i, 1);
                salvarStorage();
                renderizarProdutos();
            }
        }

        function cancelarEdicao() {
            resetarFormulario();
            indiceEdicao = null;
        }

        function resetarFormulario() {
            form.reset();
            tituloForm.textContent = 'Cadastrar Novo Produto';
            btnCancelar.classList.add('oculto');
        }

        function salvarStorage() {
            localStorage.setItem(CHAVE_STORAGE, JSON.stringify(produtos));
        }

        form.addEventListener('submit', e => {
            e.preventDefault();
            salvarProduto();
        });

        btnCancelar.addEventListener('click', cancelarEdicao);

        document.addEventListener('DOMContentLoaded', renderizarProdutos);
    </script>
</body>
</html>
